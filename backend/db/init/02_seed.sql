-- =============================



-- ТЕСТОВЫЕ ДАННЫЕ (PostgreSQL)



-- Диапазон: 2024-06-01 .. 2025-08-31



-- =============================



BEGIN;



-- 1) accounts: тестовый админ



INSERT INTO accounts (email, password_hash, full_name, role, is_active)



VALUES ('admin@test', '$2b$10$LMgHrIdwnkFbeO6YRKIEmeAxAH0Ck2J94IW4np4WW2JqvLoOxWnw2', 'Admin User', 'admin', TRUE)



ON CONFLICT (email) DO NOTHING;



-- 2) chats: 150 телеграм-чатов



-- Диапазон chat_id: 100000001..100000150



INSERT INTO chats (chat_id, username, first_name, last_name, platform)
SELECT
  100000000 + gs AS chat_id,
  'user' || gs AS username,
  (ARRAY['Алексей','Мария','Ирина','Степан','Антон','Леонид','Алиса','Максим','Артём','Дарья','Екатерина','Павел','Ольга','Глеб','Ксения','Виталий','Наталья','Григорий','Вероника','Илья'])[((gs - 1) % 20) + 1] AS first_name,
  (ARRAY['Петров','Смирнова','Иванова','Кузнецов','Попова','Соколова','Волкова','Романов','Андреев','Новикова','Гусев','Максимова','Тихонов','Федорова','Орлова','Егорова','Лебедева','Васильев','Громов','Жуков'])[((gs - 1) % 20) + 1] AS last_name,
  CASE WHEN gs % 4 = 0 THEN 'vk' ELSE 'telegram' END AS platform
FROM generate_series(1, 150) AS gs



ON CONFLICT (chat_id) DO NOTHING;



-- 3) messages: по 2 сообщения на 300 последних "диалогов"



-- Привязываем к существующим chat_id 100000001..100000150 по кольцу.



WITH t AS (
  SELECT
    gs AS rn,
    (ARRAY[
      'Привет!',
      'Здравствуйте! Сколько стоит доставка в центр?',
      'Добрый день, интересует столик на двоих на вечер.',
      'Можно ли сегодня забрать заказ самовывозом? Нужен к 18:30.',
      'Подскажите, есть ли у вас детское меню, что туда входит?',
      'Привет! Работаете ли вы завтра утром? Нужен кофе на вынос.',
      'Можно ли изменить время брони на более позднее, на 20:00?',
      'Здравствуйте! Уточните, пожалуйста, состав салата «Цезарь».',
      'Добрый вечер! Принимаете ли вы оплату картой при доставке?',
      'Хочу сделать заказ на корпоратив, можно примерный прайс и список закусок?',
      'Есть ли свободные столы на летней веранде сегодня? Будет 6 человек.',
      'Здравствуйте! Сколько гостей помещается в VIP-зале и есть ли депозит?',
      'Добрый день! Можно ли принести свой торт на праздник и взять посуду?',
      'Привет! Скажите, курьер сможет позвонить за 10 минут до приезда?'
    ])[((gs - 1) % 14) + 1] AS guest_text,
    (ARRAY[
      'Здравствуйте! Да, расскажите, что именно хотите заказать.',
      'Доставка по центру от 300 ₽, уточните адрес — рассчитаем точную сумму.',
      'Свободно. Забронировать на ваше имя? Нужен телефон для подтверждения.',
      'Самовывоз возможен. Скажем поварам, чтобы приготовили к 18:30.',
      'Есть детское меню: мини-пицца, паста, овощи, напиток. Могу прислать фото.',
      'Работаем с 9:00, бариста на месте. Можно оформить предзаказ прямо здесь.',
      'Могу предложить слоты 20:00 или 20:30. Какой удобнее, чтобы зафиксировать?',
      'Салат «Цезарь»: курица гриль, пармезан, ромэн, соус на основе анчоусов.',
      'Да, картой и переводом по QR. Курьер предупредит вас перед приездом.',
      'Отправлю подборку сетов и закусок, а также условия на компанию из 15 человек.',
      'Есть места на 19:00. Вид на набережную и пледы на случай ветра подготовим.',
      'VIP-зал вмещает до 12 гостей, депозит 20 000 ₽. Помощь администратора включена.',
      'Да, можно. Сообщите размер торта — подготовим подставку, нож и тарелки.',
      'Хорошо, передадим курьеру. Связь по телефону +7... верна?'
    ])[((gs - 1) % 14) + 1] AS operator_text
  FROM generate_series(1, 300) AS gs
)
INSERT INTO messages (chat_id, from_me, text)
SELECT 100000000 + ((rn - 1) % 150) + 1, FALSE, guest_text FROM t
UNION ALL
SELECT 100000000 + ((rn - 1) % 150) + 1, TRUE, operator_text FROM t;



-- 4) orders: ежедневно за весь период (около 457 записей)



-- order_type чередуется pickup/delivery, время из набора, суммы варьируются.



WITH days AS (



  SELECT d::date AS d, ROW_NUMBER() OVER (ORDER BY d) AS rn



  FROM generate_series('2024-06-01'::date, '2025-08-31'::date, '1 day') AS d



)



-- Телефоны повторяются по модулю 80, чтобы статистика повторных гостей не была нулевой.
INSERT INTO orders (tg_username, name, phone, order_type, date, "time", address, items, total, comment, platform)

SELECT
  'guest' || (((rn - 1) % 200) + 1) AS tg_username,
  ((ARRAY['Алексей','Марина','Ирина','Степан','Антон','Леонид','Алиса','Максим','Артём','Дарья','Екатерина','Павел','Ольга','Глеб','Ксения','Виталий','Наталья','Григорий','Вероника','Илья'])[((rn - 1) % 20) + 1]
   || ' ' ||
   (ARRAY['Петров','Смирнова','Иванова','Кузнецов','Попова','Соколова','Волкова','Романов','Андреев','Новикова','Гусев','Максимова','Тихонов','Федорова','Орлова','Егорова','Лебедева','Васильев','Громов','Жуков'])[((rn - 1) % 20) + 1]) AS name,
  '+7999' || LPAD((7000000 + ((rn - 1) % 80))::text, 7, '0') AS phone,
  CASE WHEN rn % 2 = 0 THEN 'delivery' ELSE 'pickup' END AS order_type,
  d AS "date",
  (ARRAY[time '17:00', time '18:00', time '19:00', time '20:00', time '21:00'])[(rn % 5) + 1] AS "time",
  ((ARRAY['Москва, ул. Тверская, д. ',
          'Санкт-Петербург, Невский пр., д. ',
          'Казань, ул. Баумана, д. ',
          'Сочи, ул. Виноградная, д. ',
          'Екатеринбург, ул. Ленина, д. ',
          'Новосибирск, Красный проспект, д. ',
          'Воронеж, ул. Плехановская, д. ',
          'Самара, ул. Чапаевская, д. ',
          'Ростов-на-Дону, ул. Большая Садовая, д. ',
          'Нижний Новгород, ул. Большая Покровская, д. '])[(rn - 1) % 10 + 1])
   || (((rn - 1) % 40) + 1) AS address,
  jsonb_build_array(
    jsonb_build_object(
      'dish', jsonb_build_object(
        'name', (ARRAY['Пицца Маргарита','Пицца Пепперони','Паста Карбонара','Паста Альфредо','Бургер Классический','Бургер с беконом','Салат Цезарь','Салат Греческий','Стейк Рибай','Лосось на гриле','Суп Том Ям','Ризотто с грибами'])[(((rn - 1) % 12) + 1)],
        'category', (ARRAY['Пицца','Пицца','Паста','Паста','Горячее','Горячее','Салаты','Салаты','Горячее','Горячее','Супы','Паста'])[(((rn - 1) % 12) + 1)],
        'child_category', (ARRAY['Классическая','Острая','Сливочная','Сливочная','Говядина','Говядина','Классика','Лёгкие','Премиум','Рыба','Азиатская','Авторская'])[(((rn - 1) % 12) + 1)],
        'price', metrics.price_main
      ),
      'quantity', metrics.qty_main
    ),
    jsonb_build_object(
      'dish', jsonb_build_object(
        'name', (ARRAY['Лимонад Малина','Лимонад Маракуйя','Чизкейк Нью-Йорк','Десерт Тирамису','Панна-котта','Брускетта с томатами','Картофель по-деревенски','Крылышки BBQ','Смузи Манго','Чай Облепиха','Салат с киноа','Суп Минестроне'])[(((rn - 1) % 12) + 1)],
        'category', (ARRAY['Напитки','Напитки','Десерты','Десерты','Десерты','Закуски','Гарниры','Закуски','Напитки','Напитки','Салаты','Супы'])[(((rn - 1) % 12) + 1)],
        'child_category', (ARRAY['Безалкогольные','Безалкогольные','Классика','Классика','Нежные','Хлеб и пасты','Домашние','Гриль','Фреши','Горячие','ЗОЖ','Европейские'])[(((rn - 1) % 12) + 1)],
        'price', metrics.price_extra
      ),
      'quantity', metrics.qty_extra
    )
  )::text AS items,
  (metrics.price_main * metrics.qty_main) + (metrics.price_extra * metrics.qty_extra) AS total,
  (ARRAY['Гость попросил добавить острый соус отдельно.',
         'Просьба: подписать коробки и положить салфетки.',
         'Не забыть приборы для четырёх человек.',
         'Звонить за 10 минут до приезда курьера.',
         'Пожелание: без лука в салате.',
         'Добавить одну детскую ложку, пожалуйста.',
         'Передать менеджеру: оплатит наличными без сдачи.',
         'Курьеру позвонить, домофон не работает.',
         'Просили положить extra сыр к пицце.',
         'Привезти к чёрному входу, офис на 2 этаже.'])[((rn - 1) % 10) + 1] AS comment,
  CASE WHEN rn % 5 = 0 THEN 'whatsapp' WHEN rn % 3 = 0 THEN 'vk' ELSE 'telegram' END AS platform

FROM days

CROSS JOIN LATERAL (
  SELECT
    (ARRAY[1, 2, 1, 3, 2, 4, 1, 2, 3, 2, 1, 5])[((rn - 1) % 12) + 1] AS qty_main,
    (ARRAY[420, 560, 380, 610, 450, 530, 470, 390, 660, 510, 360, 720])[((rn - 1) % 12) + 1] AS price_main,
    (ARRAY[1, 1, 2, 1, 3, 2, 2, 1, 1, 3, 2, 1])[((rn - 1) % 12) + 1] AS qty_extra,
    (ARRAY[180, 150, 210, 260, 190, 230, 205, 170, 195, 245, 215, 185])[((rn - 1) % 12) + 1] AS price_extra
) AS metrics;

-- 5) reservations: каждые 3 дня за весь период



-- Гостей 2..7, время из набора, комментарий и адрес синтетические.



WITH days AS (



  SELECT d::date AS d, ROW_NUMBER() OVER (ORDER BY d) AS rn



  FROM generate_series('2024-06-01'::date, '2025-08-31'::date, '3 days') AS d



)



-- Телефоны повторяются по модулю 60, чтобы статистика повторных гостей не была нулевой.
INSERT INTO reservations (tg_username, name, phone, address, date, "time", guests, comment, platform)

SELECT
  'guest' || (((rn - 1) % 160) + 1) AS tg_username,
  ((ARRAY['Анастасия','Елена','София','Артём','Кирилл','Михаил','Татьяна','Вера','Алина','Семен','Полина','Егор','Злата','Лев','Таисия','Арсений','Диана','Матвей','Юлия','Степан'])[((rn - 1) % 20) + 1]
   || ' ' ||
   (ARRAY['Крылова','Зайцева','Морозова','Кириллов','Рогова','Савина','Дмитриева','Ларионова','Малышева','Колесников','Филиппов','Гаврилов','Румянцева','Сафонова','Назаров','Белова','Александрова','Журавлёв','Голубева','Прохоров'])[((rn - 1) % 20) + 1]) AS name,
  '+7999' || LPAD((7555000 + ((rn - 1) % 60))::text, 7, '0') AS phone,
  ((ARRAY['Ресторан «Skyline», ул. Панорамная, ',
          'Бистро «Вкус Ветра», наб. Морская, ',
          'Лофт «Светлый», ул. Горная, ',
          'Гастробар «Соль», ул. Речная, ',
          'Стейк-хаус «Уголь», пр. Центральный, ',
          'Кафе «Грушевый сад», ул. Парковая, ',
          'Терраса «Вид на город», ул. Облачная, ',
          'Холл «Палитра», ул. Театральная, ',
          'Клуб «Ночь в городе», ул. Лунная, ',
          'Версия «Лето», ул. Набережная, '])[(rn - 1) % 10 + 1])
   || (((rn - 1) % 50) + 1) AS address,
  d AS "date",
  (ARRAY[time '17:30', time '18:00', time '18:30', time '19:00', time '19:15', time '19:30', time '19:45', time '20:00', time '20:15', time '20:30', time '20:45', time '21:00'])[(rn - 1) % 12 + 1] AS "time",
  (ARRAY[2,4,3,2,6,5,2,8,10,3,4,7,5,9])[(rn - 1) % 14 + 1] AS guests,
  (ARRAY['Пожелание: стол у окна, повод — годовщина.',
         'Попросили подготовить высокие стулья для детей.',
         'Нужно две свечи на стол, отмечают день рождения.',
         'Гость уточнил, чтобы была розетка рядом со столом.',
         'Просьба: тихая музыка, деловая встреча.',
         'Попросил оставить десерт к 20:30 и подать с табличкой.',
         'Отметили, что один гость — вегетарианец.',
         'Просьба встретить у входа и проводить до столика.',
         'Нужно принести карту вин заранее для выбора.',
         'Дополнительно подготовить детское меню и раскраски.',
         'Хотят приветственный бокал просекко для всех участников.',
         'Просьба не садить рядом с детской зоной — важный разговор.',
         'Отдельно уточнили возможность посадить группу у сцены.',
         'Гости приедут на микроавтобусе, нужно место для парковки.'])[((rn - 1) % 14) + 1] AS comment,
  CASE WHEN rn % 4 = 0 THEN 'vk' WHEN rn % 5 = 0 THEN 'whatsapp' ELSE 'telegram' END AS platform

FROM days;

COMMIT;



-- ПРИМЕЧАНИЯ:



-- • Скрипт намеренно использует generate_series и ROW_NUMBER для компактной массовой генерации.



-- • Поля "time" экранированы кавычками там, где это зарезервированное слово.



-- • Часть телефонов повторяется (модульное распределение) — это нужно для карточки “Повторные гости”.


-- • Повторный запуск не создаёт дублей в accounts/chats из-за ON CONFLICT; для messages/orders/reservations



--   предполагается отсутствие уникальных ограничений, поэтому при необходимости добавьте свои ON CONFLICT (...)



--   в соответствии с ключами схемы.
